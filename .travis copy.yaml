language: java
jdk:
    - openjdk8
  
env:
    - NODE_VERSION=12

cache:
    directories:
        - "$HOME/.cache"

jobs:
    include:
        - stage: deploy
        name: 'Deploy To CloudHub Development Environment'
        script:
        - cp .travis.settings.xml $HOME/.m2/settings.xml
        - mvn clean install deploy -DmuleDeploy -Dserver=$server -Denvironment=$environment -Dworkers=$workers -DworkerType=$workerType -DmuleVersion=$muleVersion -DappName=$appName
        on:
            branch: dev
        
    - stage: test
    name: 'Peform Newman Test'
    install:
        - nvm install $NODE_VERSION
        - npm install newman
    before_script:
        - nvm use $NODE_VERSION
        - npm --version
        - node --version
        - node_modules/.bin/newman --version
    script:
        - node_modules/.bin/newman run travis-test-app-coll.postman_collection.json --disable-unicode
    on:
        branch: dev